<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="mybatis.PartnerNGeneralQnA">
    
    <!-- 전체 리스트 불러오는 부분 -->
    <select id="PartnerNGeneralQnAList" parameterType="java.util.Map" resultType="PartnerNGeneralQNADto">	

	    SELECT h.*,subname,hosname 
	    FROM healthquestion h, subject s,hospital hos, partners p  
	    WHERE h.subjectcode=s.subjectcode AND p.hosno=hos.hosno AND pid=#{pid}
	    ORDER BY postdate DESC
   
	</select>
	
    <select id="PartnerNGeneralQnASelectLast" parameterType="java.util.Map" resultType="java.util.Map">	
		SELECT qno,subname,title FROM healthquestion h, subject s 
		WHERE h.subjectcode=s.subjectcode and qno = (SELECT MAX(qno) FROM healthquestion)      
	</select>
	
  	<select id="PartnerNGeneralQnAHosname" parameterType="java.util.Map" resultType="PartnerNGeneralQNADto">
  		SELECT hosname from hospital h, partners p where h.hosno=p.hosno and pid=#{pid}
  	</select>
  
  
    <!--  레코드 수 가져오는 부분 -->
   	<select id="PartnerNGeneralQnATotalRecord"  parameterType="java.util.Map" resultType="int">
   	
	SELECT COUNT(*) FROM HEALTHQUESTION 
	
	WHERE 
	
	<foreach collection="subjectcode" item="item" separator="or" open="(" close=")">
 	
 	 SUBJECTCODE = #{item.SUBJECTCODE}
 	
 	
 	</foreach>
 	
 	OR SUBJECTCODE = 0
	
	<if test="searchColumn !=null">
   		AND ${searchColumn} LIKE '%' || #{searchWord} || '%'
   	</if>
	</select>
	
	
	
	

   
    <!-- SelectOne -->

	<select id="PartnerNGeneralQnAOne" parameterType="java.util.Map" resultType="PartnerNGeneralQNADto">

	SELECT * FROM HEALTHQUESTION WHERE QNO = #{qno}
  
	</select>
	
	
	<!-- 특정 글에서  전체 코멘트 가져오는 부분  -->	
	<select id="PartnerNGeneralQnACommentList" parameterType="java.util.Map" resultType="java.util.Map">
<!--  
	SELECT * FROM HEALTHANSWER WHERE QNO = #{qno} ORDER BY ANO DESC   이 쿼리문은  병원이 제휴회원 아이디로 나옴
-->
	<!-- 제휴회원 아이디를 병원이름으로 가져와서 뿌려주자  -->
	select * FROM(select hos.hosname,p.pid from hospital hos join partners p on hos.hosno = p.hosno)T
	JOIN HEALTHANSWER A ON T.PID = A.PID WHERE QNO = #{qno} ORDER BY ANO DESC
 
	</select>
	
	
	
</mapper>